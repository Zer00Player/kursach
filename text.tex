%!LW recipe=latexmk (lualatex)
\documentclass[a4paper, 14pt]{extarticle}

%%%
\usepackage{ifluatex}
\usepackage{ifpdf}

\ifluatex
\usepackage{fontspec}
\defaultfontfeatures{Renderer=Basic,Ligatures={TeX}}
\setmainfont{CMU Serif}
\setsansfont{CMU Sans Serif}
\usepackage{polyglossia}
\setdefaultlanguage{russian}
\setotherlanguage{english}
\setmainfont{CMU Serif}
\newfontfamily{\cyrillicfont}{CMU Serif}
\setsansfont{CMU Sans Serif}
\newfontfamily{\cyrillicfontsf}{CMU Sans Serif}
\setmonofont{CMU Typewriter Text}
\newfontfamily{\cyrillicfonttt}{CMU Typewriter Text}
\else
\ifpdf 
\usepackage[T2A]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage[english,russian]{babel}
\typeout{PDF only}
\fi
\fi

\usepackage[left=1cm,right=1cm,top=2cm,bottom=2cm]{geometry}
%%% Дополнительная работа с математикой
\usepackage{amsfonts,amssymb,amsthm,mathtools} % AMS
\usepackage{amsmath}
\usepackage{icomma} % «Умная» запятая: $0,2$ — число, $0, 2$ — перечисление

\usepackage{mathrsfs} % Красивый матшрифт

%% Перенос знаков в формулах (по Львовскому)
\newcommand*{\hm}[1]{#1\nobreak\discretionary{}
  {\hbox{$\mathsurround=0pt #1$}}{}}

%%% Работа с картинками

\usepackage{graphicx}  % Для вставки рисунков
\graphicspath{ {images/} }
\setlength\fboxsep{3pt} % Отступ рамки \fbox{} от рисунка
\setlength\fboxrule{1pt} % Толщина линий рамки \fbox{}
\usepackage{wrapfig} % Обтекание рисунков и таблиц текстом

\usepackage[dvipsnames]{xcolor}
\usepackage{verbatim}
\usepackage{hyperref}

\usepackage{listings}

\lstdefinelanguage{JavaScript}{
  keywords={let, typeof, new, true, false, catch, function, return, null, catch, switch, var, if, in, while, do, else, case, break, const},
  keywordstyle=\color{blue}\bfseries,
  ndkeywords={class, export, boolean, throw, implements, import, this,},
  ndkeywordstyle=\color{darkgray}\bfseries,
  identifierstyle=\color{black},
  sensitive=false,
  comment=[l]{//},
  morecomment=[s]{/*}{*/},
  commentstyle=\color{green}\ttfamily,
  stringstyle=\color{red}\ttfamily,
  morestring=[b]',
  morestring=[b]",
  escapechar=|
}

\lstset{
  language=JavaScript,
  extendedchars=true,
  basicstyle=\small\ttfamily,
  showstringspaces=false,
  breakatwhitespace=true,
  showspaces=false,
  numbers=left,
  numberstyle=\footnotesize,
  numbersep=9pt,
  tabsize=2,
  keepspaces=true,
  breaklines=true,
  showtabs=false,
  captionpos=b
  escapechar=|,
  frame=single ,
  commentstyle=\itshape ,
  frameshape={RYR}{Y}{Y}{RYR},
  stringstyle =\bfseries,
}

\usepackage{autobreak}

\newcommand*{\function}[2]{\texttt{\textcolor{Red}{function} \textcolor{Purple}{#1}(#2)}\linebreak}

\newcommand*{\prototype}[3][]{\texttt{\textcolor{Orange}{#2}.\textcolor{Blue}{prototype}.\textcolor{Purple}{#3} = \textcolor{Red}{function}(#1)}\linebreak}

\usepackage{titlesec}

\setcounter{secnumdepth}{4}

\titleformat{\paragraph}
{\normalfont\normalsize\bfseries}{\theparagraph}{1em}{}
\titlespacing*{\paragraph}
{0pt}{3.25ex plus 1ex minus .2ex}{1.5ex plus .2ex}

\usepackage{multicol}
\setlength{\columnsep}{1cm}

\usepackage[most]{tcolorbox}

\newtcolorbox{leftBox}{
  colback=white,colframe=black, 
  width = 0.97\linewidth,
  sharp corners = southwest,
}

\usepackage{newfloat,caption,float}
\usepackage{capt-of}

\DeclareFloatingEnvironment[
  fileext = loe,
  listname = Задача,
  name = Задача.,
  placement = H,
  within = none,
  ]{application}
\captionsetup[application]{labelfont=md}

\DeclareFloatingEnvironment[
  fileext = loe,
  listname = Рис,
  name = Рис.,
  placement = H,
  within = none,
  ]{image}
\captionsetup[image]{labelfont=md}

\usepackage{tikz,tikz-3dplot}

\renewcommand{\lstlistingname}{Листинг}% Listing -> Листинг


\newcommand*{\task}[4]{
  \begin{minipage}[t]{\linewidth}
  \begin{multicols}{2}
    #1\\\\
    Ответ: $#2$\\
    \includegraphics[width=0.4\textwidth]{#3}
  \end{multicols}
  \captionof{application}{Пример генерации задания с помощью #4}
\end{minipage}
}

\usepackage{setspace}

\begin{document}

\include{title.tex}

\setstretch{1.5}

\tableofcontents

\include{intro.tex}


\include{part1.tex}

\include{part2.tex}

\include{part3.tex}

\include{part4.tex}

\include{conclus.tex}

\include{bibliography.tex}

\include{applications.tex}

\end{document}

